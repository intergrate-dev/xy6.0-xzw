(function(A){A.fn.extend({autocomplete:function(B,C){var D=typeof B=="string";C=A.extend({},A.Autocompleter.defaults,{url:D?B:null,data:D?null:B,delay:D?A.Autocompleter.defaults.delay:10,max:C&&!C.scroll?10:150,noRecord:"No Records."},C);C.highlight=C.highlight||function(E){return E};C.formatMatch=C.formatMatch||C.formatItem;return this.each(function(){new A.Autocompleter(this,C)})},result:function(B){return this.bind("result",B)},search:function(B){return this.trigger("search",[B])},flushCache:function(){return this.trigger("flushCache")},setOptions:function(B){return this.trigger("setOptions",[B])},unautocomplete:function(){return this.trigger("unautocomplete")}});A.Autocompleter=function(N,U){var O={UP:38,DOWN:40,DEL:46,TAB:9,RETURN:13,ESC:27,COMMA:188,PAGEUP:33,PAGEDOWN:34,BACKSPACE:8};var E=null;if(U.failure!=null&&typeof U.failure=="function"){E=U.failure}var I=A(N).attr("autocomplete","off").addClass(U.inputClass);var P;var D="";var H=A.Autocompleter.Cache(U);var V=0;var R;var W={mouseDownOnSelect:false};var Q=A.Autocompleter.Select(U,N,T,W);var L;A.browser.opera&&A(N.form).bind("submit.autocomplete",function(){if(L){L=false;return false}});I.bind((A.browser.opera?"keypress":"keydown")+".autocomplete",function(Z){V=1;R=Z.keyCode;switch(Z.keyCode){case O.UP:if(Q.visible()){Z.preventDefault();Q.prev()}else{C(0,true)}break;case O.DOWN:if(Q.visible()){Z.preventDefault();Q.next()}else{C(0,true)}break;case O.PAGEUP:if(Q.visible()){Z.preventDefault();Q.pageUp()}else{C(0,true)}break;case O.PAGEDOWN:if(Q.visible()){Z.preventDefault();Q.pageDown()}else{C(0,true)}break;case U.multiple&&A.trim(U.multipleSeparator)==","&&O.COMMA:case O.TAB:case O.RETURN:if(T()){Z.preventDefault();L=true;return false}break;case O.ESC:Q.hide();break;default:clearTimeout(P);P=setTimeout(C,U.delay);break}}).focus(function(){V++}).blur(function(){V=0;if(!W.mouseDownOnSelect){M()}}).click(function(){if(U.clickFire){if(!Q.visible()){C(0,true)}}else{if(V++>1&&!Q.visible()){C(0,true)}}}).bind("search",function(){var a=(arguments.length>1)?arguments[1]:null;function Z(d,e){var c;if(e&&e.length){for(var b=0;b<e.length;b++){if(e[b].result.toLowerCase()==d.toLowerCase()){c=e[b];break}}}if(typeof a=="function"){a(c)}else{I.trigger("result",c&&[c.data,c.value])}}A.each(F(I.val()),function(b,c){J(c,Z,Z)})}).bind("flushCache",function(){H.flush()}).bind("setOptions",function(){A.extend(true,U,arguments[1]);if("data" in arguments[1]){H.populate()}}).bind("unautocomplete",function(){Q.unbind();I.unbind();A(N.form).unbind(".autocomplete")});function T(){var f=Q.selected();if(!f){return false}var d=f.result;D=d;if(U.multiple){var Z=F(I.val());if(Z.length>1){var e=U.multipleSeparator.length;var c=A(N).selection().start;var b,a=0;A.each(Z,function(g,h){a+=h.length;if(c<=a){b=g;return false}a+=e});Z[b]=d;d=Z.join(U.multipleSeparator)}d+=U.multipleSeparator}I.val(d);B();I.trigger("result",[f.data,f.value]);return true}function C(Z,a){if(R==O.DEL){Q.hide();return}var b=I.val();if(!a&&b==D){return}D=b;b=K(b);if(b.length>=U.minChars){I.addClass(U.loadingClass);if(!U.matchCase){b=b.toLowerCase()}J(b,X,B)}else{S();Q.hide()}}function F(Z){if(!Z){return[""]}if(!U.multiple){return[A.trim(Z)]}return A.map(Z.split(U.multipleSeparator),function(a){return A.trim(Z).length?A.trim(a):null})}function K(b){if(!U.multiple){return b}var Z=F(b);if(Z.length==1){return Z[0]}var a=A(N).selection().start;if(a==b.length){Z=F(b)}else{Z=F(b.replace(b.substring(a),""))}return Z[Z.length-1]}function Y(a,Z){if(U.autoFill&&(K(I.val()).toLowerCase()==a.toLowerCase())&&R!=O.BACKSPACE){I.val(I.val()+Z.substring(K(D).length));A(N).selection(D.length,D.length+Z.length)}}function M(){clearTimeout(P);P=setTimeout(B,200)}function B(){var Z=Q.visible();Q.hide();clearTimeout(P);S();if(U.mustMatch){I.search(function(b){if(!b){if(U.multiple){var a=F(I.val()).slice(0,-1);I.val(a.join(U.multipleSeparator)+(a.length?U.multipleSeparator:""))}else{I.val("");I.trigger("result",null)}}})}}function X(Z,a){if(a&&a.length&&V){S();Q.display(a,Z);Y(Z,a[0].value);Q.show()}else{B()}}function J(d,Z,b){if(!U.matchCase){d=d.toLowerCase()}var e=H.load(d);if(e){if(e.length){Z(d,e)}else{var c=U.parse&&U.parse(U.noRecord)||G(U.noRecord);Z(d,c)}}else{if((typeof U.url=="string")&&(U.url.length>0)){var a={timestamp:+new Date()};A.each(U.extraParams,function(f,g){a[f]=typeof g=="function"?g():g});A.ajax({mode:"abort",port:"autocomplete"+N.name,dataType:U.dataType,url:U.url,data:A.extend({q:K(d),limit:U.max},a),success:function(g){var f=U.parse&&U.parse(g)||G(g);H.add(d,f);Z(d,f)}})}else{Q.emptyList();if(E!=null){E()}else{b(d)}}}}function G(d){var c=[];var b=d.split("\n");for(var Z=0;Z<b.length;Z++){var a=A.trim(b[Z]);if(a){a=a.split("|");c[c.length]={data:a,value:a[0],result:U.formatResult&&U.formatResult(a,a[0])||a[0]}}}return c}function S(){I.removeClass(U.loadingClass)}};A.Autocompleter.defaults={inputClass:"ac_input",resultsClass:"ac_results",loadingClass:"ac_loading",minChars:1,delay:400,matchCase:false,matchSubset:true,matchContains:false,cacheLength:100,max:1000,mustMatch:false,extraParams:{},selectFirst:true,formatItem:function(B){return B[0]},formatMatch:null,autoFill:false,width:0,multiple:false,multipleSeparator:" ",inputFocus:true,clickFire:false,highlight:function(C,B){return C.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+B.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>")},scroll:true,scrollHeight:180,scrollJumpPosition:true};A.Autocompleter.Cache=function(E){var H={};var B=0;function C(J,K){if(!E.matchCase){J=J.toLowerCase()}var I=J.indexOf(K);if(E.matchContains=="word"){I=J.toLowerCase().search("\\b"+K.toLowerCase())}if(I==-1){return false}return I==0||E.matchContains}function G(I,J){if(B>E.cacheLength){D()}if(!H[I]){B++}H[I]=J}function F(){if(!E.data){return false}var N={},K=0;if(!E.url){E.cacheLength=1}N[""]=[];for(var M=0,I=E.data.length;M<I;M++){var J=E.data[M];J=(typeof J=="string")?[J]:J;var L=E.formatMatch(J,M+1,E.data.length);if(typeof(L)==="undefined"||L===false){continue}var O=L.charAt(0).toLowerCase();if(!N[O]){N[O]=[]}var P={value:L,data:J,result:E.formatResult&&E.formatResult(J)||L};N[O].push(P);if(K++<E.max){N[""].push(P)}}A.each(N,function(Q,R){E.cacheLength++;G(Q,R)})}setTimeout(F,25);function D(){H={};B=0}return{flush:D,add:G,populate:F,load:function(K){if(!E.cacheLength||!B){return null}if(!E.url&&E.matchContains){var M=[];for(var I in H){if(I.length>0){var L=H[I];A.each(L,function(N,O){if(C(O.value,K)){M.push(O)}})}}return M}else{if(H[K]){return H[K]}else{if(E.matchSubset){for(var J=K.length-1;J>=E.minChars;J--){var L=H[K.substr(0,J)];if(L){var M=[];A.each(L,function(N,O){if(C(O.value,K)){M[M.length]=O}});return M}}}}}return null}}};A.Autocompleter.Select=function(K,G,H,Q){var I={ACTIVE:"ac_over"};var M,D=-1,N,L="",C=true,J,B;function R(){if(!C){return}J=A("<div/>").hide().addClass(K.resultsClass).css("position","absolute").appendTo(document.body).hover(function(T){if(A(this).is(":visible")){G.focus()}Q.mouseDownOnSelect=false});B=A("<ul/>").appendTo(J).mouseover(function(T){if(O(T).nodeName&&O(T).nodeName.toUpperCase()=="LI"){D=A("li",B).removeClass(I.ACTIVE).index(O(T));A(O(T)).addClass(I.ACTIVE)}}).click(function(T){A(O(T)).addClass(I.ACTIVE);H();if(K.inputFocus){G.focus()}return false}).mousedown(function(){Q.mouseDownOnSelect=true}).mouseup(function(){Q.mouseDownOnSelect=false});if(K.width>0){J.css("width",K.width)}C=false}function O(T){var U=T.target;while(U&&U.tagName!="LI"){U=U.parentNode}if(!U){return[]}return U}function P(T){M.slice(D,D+1).removeClass(I.ACTIVE);S(T);var V=M.slice(D,D+1).addClass(I.ACTIVE);if(K.scroll){var U=0;M.slice(0,D).each(function(){U+=this.offsetHeight});if((U+V[0].offsetHeight-B.scrollTop())>B[0].clientHeight){B.scrollTop(U+V[0].offsetHeight-B.innerHeight())}else{if(U<B.scrollTop()){B.scrollTop(U)}}}}function S(T){if(K.scrollJumpPosition||(!K.scrollJumpPosition&&!((T<0&&D==0)||(T>0&&D==M.size()-1)))){D+=T;if(D<0){D=M.size()-1}else{if(D>=M.size()){D=0}}}}function F(T){return K.max&&K.max<T?K.max:T}function E(){B.empty();var W=F(N.length);for(var U=0;U<W;U++){if(!N[U]){continue}var T=K.formatItem(N[U].data,U+1,W,N[U].value,L);if(T===false){continue}var V=A("<li/>").html(K.highlight(T,L)).addClass(U%2==0?"ac_even":"ac_odd").appendTo(B)[0];A.data(V,"ac_data",N[U])}M=B.find("li");if(K.selectFirst){M.slice(0,1).addClass(I.ACTIVE);D=0}if(A.fn.bgiframe){B.bgiframe()}}return{display:function(T,U){R();N=T;L=U;E()},next:function(){P(1)},prev:function(){P(-1)},pageUp:function(){if(D!=0&&D-8<0){P(-D)}else{P(-8)}},pageDown:function(){if(D!=M.size()-1&&D+8>M.size()){P(M.size()-1-D)}else{P(8)}},hide:function(){J&&J.hide();M&&M.removeClass(I.ACTIVE);D=-1},visible:function(){return J&&J.is(":visible")},current:function(){return this.visible()&&(M.filter("."+I.ACTIVE)[0]||K.selectFirst&&M[0])},show:function(){var T=A(G).offset();J.css({width:typeof K.width=="string"||K.width>0?K.width:(A(G).width()+parseInt(A(G).css("border-left-width"),10)+parseInt(A(G).css("border-right-width"),10)),top:T.top+G.offsetHeight,left:T.left}).show();if(K.scroll){B.scrollTop(0);B.css({maxHeight:K.scrollHeight,overflow:"auto"});if(A.browser.msie&&typeof document.body.style.maxHeight==="undefined"){var U=0;M.each(function(){U+=this.offsetHeight});var V=U>K.scrollHeight;B.css("height",V?K.scrollHeight:U);if(!V){M.width(B.width()-parseInt(M.css("padding-left"))-parseInt(M.css("padding-right")))}}}},selected:function(){var T=M&&M.filter("."+I.ACTIVE).removeClass(I.ACTIVE);return T&&T.length&&A.data(T[0],"ac_data")},emptyList:function(){B&&B.empty()},unbind:function(){J&&J.remove()}}};A.fn.selection=function(B,C){if(B!==undefined){return this.each(function(){if(this.createTextRange){var J=this.createTextRange();if(C===undefined||B==C){J.move("character",B);J.select()}else{J.collapse(true);J.moveStart("character",B);J.moveEnd("character",C);J.select()}}else{if(this.setSelectionRange){this.setSelectionRange(B,C)}else{if(this.selectionStart){this.selectionStart=B;this.selectionEnd=C}}}})}var E=this[0];if(E.createTextRange){var H=document.selection.createRange(),I=E.value,D="<->",G=H.text.length;H.text=D;var F=E.value.indexOf(D);E.value=I;this.selection(F,F+G);return{start:F,end:F+G}}else{if(E.selectionStart!==undefined){return{start:E.selectionStart,end:E.selectionEnd}}}}})(jQuery);